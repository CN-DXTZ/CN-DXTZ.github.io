<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

	<title>DXTZ</title>
	<link rel="icon" href="/images/favicon.ico">

	
<link rel="stylesheet" href="/css/style.css">

	<link href="//at.alicdn.com/t/font_1660778_ufn05bndyb.css" rel="stylesheet">
	
	<link href="//cdn.jsdelivr.net/gh/CN-DXTZ/CN-DXTZ.github.io/css/third%20party/prism.min.css" rel="stylesheet">
	
	<link href="//cdn.jsdelivr.net/gh/CN-DXTZ/CN-DXTZ.github.io/css/third%20party/jquery.fancybox.min.css" rel="stylesheet">
<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <header class="header">

	<div class="blog-title">
		<a href="/">DXTZ</a>
	</div>

	<nav class="navbar">
		<ul class="menu">
			
			<li class="menu-item">

				<a href="/" class="menu-item-link">
					首页
				</a>

			</li>
			
			<li class="menu-item">

				<a href="/categories" class="menu-item-link">
					分类
				</a>

			</li>
			
			<li class="menu-item">

				<a href="/archives" class="menu-item-link">
					归档
				</a>

			</li>
			
			<li class="menu-item">

				<a href="/tags" class="menu-item-link">
					标签
				</a>

			</li>
			
			<li class="menu-item">

				<a href="/about" class="menu-item-link">
					关于
				</a>

			</li>
			
		</ul>
	</nav>

</header>

    <main class="main">
        <section class="posts">
	<article class="post">
    <div class="post-header">
    <h1 class="post-title">
        <a class="post-title-link" href="/JAVA/JAVA Core/多线程与并发/">
            多线程与并发
        </a>
    </h1>

    <div class="post-info">

        <span class="post-date">
            <i class="iconfont icon-calendar"></i>
            2020-03-05
        </span>

        <span class="post-words">
            <i class="iconfont icon-write"></i>
            932字
        </span>

        <span class="post-readtime">
            <i class="iconfont icon-shijian"></i>
            4分钟
        </span>

    </div>

    <div class="post-belong">

        <span class="post-tags">
            <i class="iconfont icon-tags"></i>
            
            <a href="/tags/JAVA/"> JAVA</a> <a href="/tags/线程/"> 线程</a> <a href="/tags/多线程/"> 多线程</a> <a href="/tags/并发/"> 并发</a>
        </span>

        <span class="post-categories">
            <i class="iconfont icon-folderopen"></i>
            
            <a href="/categories/JAVA/"> JAVA</a>
        </span>
    </div>
</div>

    <div class="post-content">
        <a id="more"></a>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><h3 id="线程和进程"><a href="#线程和进程" class="headerlink" title="线程和进程"></a>线程和进程</h3><ul>
<li>进程：程序进入内存后的程序实例。  <ul>
<li>每个进程都独占使用主存（虚拟内存），即都有独立的代码和数据空间（进程上下文）。</li>
<li>进程的创建、释放、切换的开销大。</li>
</ul>
</li>
<li>线程：线程是程序内部的顺序控制流，可视作轻量的进程。<ul>
<li>每个线程都运行在各自进程的虚拟内存中，即共享代码和数据空间；<br>但每个线程有独立的运行栈和程序计数器。</li>
<li>线程的创建、释放、切换的开销小，内部通信效率高。</li>
</ul>
</li>
<li>多进程和多线程<ul>
<li>多进程：在操作系统中，能同时运行多个进程</li>
<li>多线程：在进程中，能同时运行多个顺序控制流（线程）</li>
</ul>
</li>
</ul>
<h3 id="线程的简单实现"><a href="#线程的简单实现" class="headerlink" title="线程的简单实现"></a>线程的简单实现</h3><p>线程的概念模型为 java.lang.Thread 包，以下介绍两种常用的方法简单实现线程实例化调用：</p>
<h4 id="Override-run"><a href="#Override-run" class="headerlink" title="Override run()"></a>Override run()</h4><p>Thread类内部有一个run()方法，通过继承Thread类并重写run()方法，即可定义所需的线程派生子类，然后通过其start()方法即可启动线程，自动运行run()方法，具体的：</p>
<p>首先定义一个Thread的派生子类，并重写其run()方法：</p>
<pre><code class="lang-java">import java.lang.Thread;
import java.lang.Math;

class MyRun extends Thread {
    private int sleepTime;

    public MyRun(String name) {
        super(name);
        sleepTime = (int) (Math.random() * 6000);
    }

    @Override
    public void run() {
        try {
            System.out.println(getName() + &quot; will sleep &quot; + sleepTime);
            Thread.sleep(sleepTime);
        } catch (Exception e) {
        }
        System.out.println(getName() + &quot; finished&quot;);
    }
}
</code></pre>
<p>再在主方法内实例化线程派生子类并通过start()方法调用线程：</p>
<pre><code class="lang-java">class ThreadMain {
    public static void main(String args[]) {
        System.out.println(&quot;ThreadMain Starting:&quot;);
        for (int i = 1; i &lt;= 3; i++) {
            new MyRun(&quot;run-&quot; + i).start();
        }
        System.out.println(&quot;ThreadMain end!&quot;);
    }
}
</code></pre>
<p>其运行结果如下：</p>
<blockquote>
<p>ThreadMain Starting:<br>  ThreadMain end!<br>  run-3 will sleep 3404<br>  run-1 will sleep 5259<br>  run-2 will sleep 715<br>  run-2 finished<br>  run-3 finished<br>  run-1 finished  </p>
</blockquote>
<p>显然，从结果可以发现以下几点：</p>
<ul>
<li>main()方法就是一个（主）线程</li>
<li>run()方法无需直接通过调用执行，而是通过Thread的派生类实例调用start()方法启动线程，然后自动执行线程的run()方法</li>
<li>多个线程并发执行，（随机）抢占CPU的执行调度</li>
</ul>
<p>具体的运行时的内存分配过程如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CN-DXTZ/Blog-Img-Bed/PicGo/Thread_1.png" alt="Thread_1.png"></p>
<h4 id="implements-Runnable"><a href="#implements-Runnable" class="headerlink" title="implements Runnable"></a>implements Runnable</h4><p>Runnable的特性：</p>
<ul>
<li>Runnable接口只有一个方法——run()方法</li>
<li>Thread类实现了Runnable接口——<code>public class Thread implements Runnable {}</code></li>
<li>Runnable的优势：<ul>
<li>Java不支持多继承，若要继承Thread类，则无法继承其他类，则可通过实现Runnable接口完成</li>
<li>便于多个线程间共享资源</li>
</ul>
</li>
<li>Runnable的使用：<ol>
<li>以实现Runnable接口的类的实例化对象构造Thread——<code>Thread(Runnable target);</code></li>
<li>依旧通过start()方法启动线程自动执行run()方法</li>
</ol>
</li>
</ul>
<p>具体的代码如下（已高亮关键变化）：</p>
<ol>
<li>首先类似继承Thread实现Runnable重写run()</li>
<li>然后实例化实现Runnable接口的类</li>
<li>再把实例化Runnable对象传递给Thread用于构造Thread对象</li>
<li>最后通过Thread对象start()方法启动线程，自动调用run()方法</li>
</ol>
<pre><code class="lang-diff-java">// MyRunnable.java
iimport java.lang.Thread;
import java.lang.Math;

- class MyRun extends Thread {
+ class MyRunnable implements Runnable {
    private int sleepTime;

    public MyRunnable() {
        this.sleepTime = (int) (Math.random() * 6000);
    }

    @Override
    public void run() {
        try {
-           System.out.println(getName() + &quot; will sleep &quot; + sleepTime);
+           System.out.println(Thread.currentThread().getName() + &quot; will sleep &quot; + sleepTime);
            Thread.sleep(sleepTime);
        } catch (Exception e) {
        }
-       System.out.println(getName() + &quot; finished&quot;);
+       System.out.println(Thread.currentThread().getName() + &quot; finished&quot;);
    }
}


// ThreadMain.java
class ThreadMain {
    public static void main(String args[]) {
        System.out.println(&quot;ThreadMain Starting:&quot;);
        for (int i = 1; i &lt;= 3; i++) {
-           new MyRun(&quot;thread-&quot; + i).start();
+           MyRunnable mr = new MyRunnable(&quot;thread-&quot; + i);
+           new Thread(mr).start();
        }
        System.out.println(&quot;ThreadMain end!&quot;);
    }
}
</code></pre>
<p>其结果类似如下：</p>
<blockquote>
<p>ThreadMain Starting:<br>  ThreadMain end!<br>  Runnable-3 will sleep 1259<br>  Runnable-1 will sleep 139<br>  Runnable-2 will sleep 4226<br>  Runnable-1 finished<br>  Runnable-3 finished<br>  Runnable-2 finished</p>
</blockquote>
<h2 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h2><h2 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h2>
    </div>

    <div class="post-nav">
        <span class="post-nav-prev">
            
        </span>
        <span class="post-nav-next">
            
            <a href="/%E6%9D%82/%E6%80%BB%E7%BB%93/2020%20%E5%B9%B4%203%20%E6%9C%88/" rel="next" title="2020 年 3 月">
                2020 年 3 月<i class="iconfont icon-qianjin"></i>
            </a>
            
        </span>
    </div>
</article>

<div class="post-toc">
    <div class="toc-title">
        <i class="iconfont icon-mulu"></i>
        文章目录
        <span>
            <i class="iconfont icon-houtui"></i>
        </span>
    </div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#线程"><span class="toc-number">1.</span> <span class="toc-text">线程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#线程和进程"><span class="toc-number">1.1.</span> <span class="toc-text">线程和进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线程的简单实现"><span class="toc-number">1.2.</span> <span class="toc-text">线程的简单实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Override-run"><span class="toc-number">1.2.1.</span> <span class="toc-text">Override run()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#implements-Runnable"><span class="toc-number">1.2.2.</span> <span class="toc-text">implements Runnable</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程同步"><span class="toc-number">2.</span> <span class="toc-text">线程同步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程安全"><span class="toc-number">3.</span> <span class="toc-text">线程安全</span></a></li></ol>
</div>
</section>	

    </main>

    <div class="footer">
	<div class="platform">
		
			
			
				<a class="iconfont icon-gmail"  href="mailto:dengbin1213@gmail.com" target="_blank"></a>
							
		
			
			
				<a class="iconfont icon-github"  href="https://github.com/CN-DXTZ" target="_blank"></a>
							
		
			
			
				<a class="iconfont icon-zhihu"  href="https://www.zhihu.com/people/DXTZ/" target="_blank"></a>
							
		
			
			
				<a class="iconfont icon-qq-email"  href="mailto:2924380441@qq.com" target="_blank"></a>
							
		
			
							
		
			
							
		
	</div>
	
	<div class="copyright-info">
			<span>Copyright © 2020 - 2020</span>
			<a href="/">DXTZ</a> 
	</div>
</div>

    <div class="after-footer">

    
<script src="/js/navbar.js"></script>


    
<script src="/js/littleCode.js"></script>


    <script src="//cdn.jsdelivr.net/gh/CN-DXTZ/CN-DXTZ.github.io/js/third%20party/instantpage.min.js"type="module"></script>

    <script src="//cdn.jsdelivr.net/gh/CN-DXTZ/CN-DXTZ.github.io/js/third%20party/jquery.min.js"></script>

    <script src="//cdn.jsdelivr.net/gh/CN-DXTZ/CN-DXTZ.github.io/js/third%20party/vanilla-back-to-top.min.js"></script>
    
<script src="/js/addBackToTop.js"></script>


    
        <script src="//cdn.jsdelivr.net/gh/CN-DXTZ/CN-DXTZ.github.io/js/third%20party/jquery.fancybox.min.js"type="module"></script>
        
<script src="/js/jquery.fancybox.image.js"></script>


        
<script src="/js/jquery.toc.js"></script>

    

    <script src="//cdn.jsdelivr.net/gh/CN-DXTZ/CN-DXTZ.github.io/js/third%20party/prism.min.js" type="module"></script>

</div>
</body>

</html>